;radius
o<radius> sub

;o<backup_status> call

#<x_end>        = #1
#<z_end>        = #2
#<radius>       = #3 ;will be cut if greater than 0
#<doc>          = #4 ;depth of cut
#<location>     = #5 (0: front-exterior, 1: front-interior, 2: back-exterior)


G7  ; Lathe diameter mode
G18 ; XZ Plane
G21 ; Metric Units
G90 ; Absolute Distance

#<x_end> = [#<x_end> / 2] ; because of radius mode

#<x_start> = #<_x> (starting X)
#<z_start> = #<_z> (starting Z)

#<temp> = 0

     O200 if [#<location> EQ 0] ; front-exterior
          o201 while [[#<temp> + #<doc>] lt #<radius>]
               #<temp> = [#<temp> + #<doc>]
               G0 X[#<x_end> - #<temp>] Z#<z_start>
               G1 Z#<z_end>
               G3 X#<x_end> Z[#<z_end> - #<temp>] K[-#<temp>]
               G1 X#<x_start>
               G0 Z#<z_start>
          o201 endwhile

               G0 X#<x_start> Z#<z_start>
               G0 X[#<x_end> - #<radius>]
               G1 Z#<z_end>
               G3 X#<x_end> Z[#<z_end> - #<radius>] K[-#<radius>]
               G1 X#<x_start>
               G0 Z#<z_start>


     O200 elseif [#<location> EQ 1] ; front-interior
          o202 while [[#<temp> + #<doc>] lt #<radius>]
               #<temp> = [#<temp> + #<doc>]
               G0 x[#<x_end> + #<temp>] z#<z_start>
               G1 z#<z_end>
               G2 x#<x_end> z[#<z_end> - #<temp>] K[-#<temp>]
               G1 x#<x_start>
               G0 z#<z_start>
          o202endwhile

          G0 x#<x_start> z#<z_start>
          G0 x[#<x_end> + #<radius>]
          G1 z#<z_end>
          G2 x#<x_end> z[#<z_end> - #<radius>] K[-#<radius>]
          G1 x#<x_start>
          G0 z#<z_start>


     O300 elseif [#<location> EQ 2] ; back-exterior
          o301 while [[#<temp> + #<doc>] lt #<radius>]
               #<temp> = [#<temp> + #<doc>]
               G0 x[#<x_end> - #<temp>] z#<z_start>
               G1 z#<z_end>
               G2 x#<x_end> z[#<z_end> + #<temp>] K#<temp>
               G1 x#<x_start>
               G0 z#<z_start>
          o301 endwhile

          G0 x#<x_start> z#<z_start>
          G0 x[#<x_end> - #<radius_size>]
          G1 z#<z_end>
          G2 x#<x_end> z[#<z_end> + #<radius>] K#<radius>
          G1 x#<x_start>
          G0 z#<z_start>
     O300 endif

;o<backup_restore> call     ; restore g20/21, g90/g91, feedrate cuter-comp and other using now global _backup_var

o<radius> endsub

M2
%
