o<chamfer> sub

#<x_start>         = #1 (in diameter mode)
#<z_start>         = #2
#<corner_x>        = #3 (in diameter mode)
#<corner_z>        = #4
#<chamfer>         = #5 (will be cut if > 0)
#<doc>             = #6 (depth of cut)
#<location>        = #7 (0: front-exterior, 1: front-interior, 2: back-exterior)

G8  ; Lathe radius Mode
G18 ; XZ Plane
G21 ; Metric Units
G90 ; Absolute Distance

#<x_start> = [#<x_start> / 2] ; because of radius mode
#<corner_x> = [#<corner_x> / 2] ; because of radius mode


#<temp> = 0
    O200 if [#<location> EQ 0] ; front-exterior
         o201 while [[#<temp> + #<doc> ] lt #<chamfer> ]
              #<temp> = [#<temp> + #<doc> ]
              G0 x[#<corner_x> - #<temp>] z#<z_start>
              G1 z#<corner_z>
              G1 x#<corner_x> z[#<corner_z> - #<temp>]
              G1 x#<x_start>
              G0 z#<z_start>
         o201 endwhile

         G0 x#<x_start> z#<z_start>
         G0 x[#<corner_x> - #<chamfer> ]
         G1 z#<corner_z>
         G1 x#<corner_x> z[#<corner_z> - #<chamfer> ]
         G1 x#<x_start>
         G0 z#<z_start>


    O200 elseif [#<location> EQ 1] ; front-interior
         o202 while [[#<temp> + #<doc> ] lt #<chamfer>  ]
              #<temp> = [#<temp> + #<doc> ]
              G0 x[#<corner_x> + #<temp>] z#<z_start>
              G1 z#<corner_z>
              G1 x#<corner_x> z[#<corner_z> - #<temp>]
              G1 x#<x_start>
              G0 z#<z_start>
         o202 endwhile

         G0 x#<x_start> z#<z_start>
         G0 x[#<corner_x> + #<chamfer>  ]
         G1 z#<corner_z>
         G1 x#<corner_x> z[#<corner_z> - #<chamfer> ]
         G1 x#<x_start>
         G0 z#<z_start>


    O200 elseif [#<location> EQ 2] ; back-exterior
         o203 while [[#<temp> + #<doc> ] lt <chamfer>]
              #<temp> = [#<temp> + #<doc> ]
              G0 x[#<corner_x> - #<temp>] z#<z_start>
              G1 z#<corner_z>
              G1 x#<corner_x> z[#<corner_z> + #<temp>]
              G1 x#<x_start>
              G0 z#<z_start>
         o203 endwhile

         G0 x#<x_start> z#<z_start>
         G0 x[#<corner_x> - <chamfer>]
         G1 z#<corner_z>
         G1 x#<corner_x> z[#<corner_z> + <chamfer> ]
         G1 x#<x_start>
         G0 z#<z_start>
    O200 endif

G7
o<chamfer> endsub
